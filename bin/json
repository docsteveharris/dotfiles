#!/usr/bin/env bash

OPT_COLOR=""

while getopts ":c" OPT; do
  case "$OPT" in
  c) OPT_COLOR="--color" ;;
  esac
done

shift $((OPTIND - 1))

if [ $# -ge 1 ]; then
  if [[ "$1" == http* ]]; then
    INPUT=$(curl --silent "$1")
  elif [ -f "$1" ]; then
    INPUT=$(cat "$1")
  fi
else
  INPUT=$(cat -)
fi

if command -v jq >/dev/null 2>&1; then
  # Pretty-print JSON using jq
  echo "$INPUT" | jq .
elif command -v underscore >/dev/null 2>&1; then
  echo "$INPUT" | underscore print "$OPT_COLOR"
else
  echo "json: requires jq or underscore-cli" >&2
  exit 127
fi
